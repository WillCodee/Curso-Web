<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XMLS Request Promisses - AJAX</title>
    <link rel="stylesheet" href="../MODELO/assets/CSS/style.css">
</head>

<body>
    <section class="container">
        <h1>XMLS Request Promisses</h1>
        <a href="pagia1.html">Pagina 1</a>
        <a href="pagina2.html">Pagina 2</a>
        <a href="pagina3.html">Pagina 3</a>

        <div class="resultado"></div>
    </section>

</body>

<script src="Fetch(API).js"></script>
<script>
    const request = obj => {
        return new Promise((resolve,reject)=>{
            const xhr  = new XMLHttpRequest();
        xhr.open(obj.method, obj.url, true) 
        //metodo , url , sincrono(true) ou assicrono(false)
        xhr.send() //Se fosse um post, manda ai os dados do formulario
        //send pedido sendo enviado

        xhr.addEventListener('load', () =>{ //ele vai executar o que estÃ¡ dentro das chaves.
            //Codigo de status entre 200 e 299 significa q esta tudo certo
            if(xhr.status >= 200 && xhr.status < 300){
                resolve(xhr.responseText);
            } else{
                reject(xhr.status)
            }
        })
        })
        
    };

    document.addEventListener('click', e => {
        const el = e.target; //Qual elemento disparou um evento
        const tag = el.tagName.toLowerCase()

        if(tag === 'a'){
            e.preventDefault()
            carregaPagina(el);
        }
    });

    async function carregaPagina(el){
        const href = el.getAttribute('href')

        const objConfig={
            method: 'GET',
            url: href,
        };

        try{
            const response = await request(objConfig)
        carregaResultado(response)
        }catch(e){
            console.log(e)
        }
        
    }

    function carregaResultado(response){
        const resultado = document.querySelector('.resultado')
        resultado.innerHTML = response
    }
</script>
</html>